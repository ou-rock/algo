<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®—æ³•å¯è§†åŒ–å·¥å…· - Algorithm Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 1.1em;
        }

        .algorithm-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-sort {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-search {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-simple {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-control {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .visualization {
            padding: 40px;
            min-height: 400px;
            position: relative;
        }

        .canvas-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        canvas {
            display: block;
            margin: 0 auto;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }

        .info-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .info-panel h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .info-panel p {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-card .label {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .speed-control input[type="range"] {
            flex: 1;
        }

        footer {
            background: #212529;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
        }

        .description-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #495057;
            font-weight: 500;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .animating {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ ç®—æ³•å¯è§†åŒ–å·¥å…·</h1>
            <p>Algorithm Visualization Tool - ç›´è§‚ç†è§£ç®—æ³•åŸç†</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label>ğŸ“Š é€‰æ‹©ç®—æ³•ç±»å‹:</label>
                <div class="algorithm-buttons">
                    <button class="btn-sort" onclick="visualize('bubbleSort')">å†’æ³¡æ’åº</button>
                    <button class="btn-sort" onclick="visualize('insertionSort')">æ’å…¥æ’åº</button>
                    <button class="btn-sort" onclick="visualize('selectionSort')">é€‰æ‹©æ’åº</button>
                    <button class="btn-search" onclick="visualize('binarySearch')">äºŒåˆ†æŸ¥æ‰¾</button>
                    <button class="btn-simple" onclick="visualize('findMax')">æŸ¥æ‰¾æœ€å¤§å€¼</button>
                    <button class="btn-simple" onclick="visualize('arraySum')">æ•°ç»„æ±‚å’Œ</button>
                </div>
            </div>

            <div class="control-group">
                <label>ğŸ”¢ è¾“å…¥æ•°æ® (ç”¨é€—å·åˆ†éš”):</label>
                <input type="text" id="dataInput" value="64, 34, 25, 12, 22, 11, 90"
                       placeholder="ä¾‹å¦‚: 5, 2, 8, 1, 9, 3">
            </div>

            <div class="control-group" id="targetGroup" style="display: none;">
                <label>ğŸ¯ æŸ¥æ‰¾ç›®æ ‡å€¼:</label>
                <input type="number" id="targetInput" value="25">
            </div>

            <div class="control-group">
                <label>âš¡ åŠ¨ç”»é€Ÿåº¦:</label>
                <div class="speed-control">
                    <span>æ…¢</span>
                    <input type="range" id="speedControl" min="100" max="2000" value="800" step="100">
                    <span>å¿«</span>
                    <span id="speedValue">800ms</span>
                </div>
            </div>

            <div class="algorithm-buttons">
                <button class="btn-control" onclick="startAnimation()">â–¶ï¸ å¼€å§‹</button>
                <button class="btn-control" onclick="pauseAnimation()">â¸ï¸ æš‚åœ</button>
                <button class="btn-control" onclick="stepForward()">â­ï¸ ä¸‹ä¸€æ­¥</button>
                <button class="btn-reset" onclick="resetAnimation()">ğŸ”„ é‡ç½®</button>
                <button class="btn-reset" onclick="generateRandomData()">ğŸ² éšæœºæ•°æ®</button>
            </div>
        </div>

        <div class="visualization">
            <div class="description-box" id="algorithmDescription">
                é€‰æ‹©ä¸€ä¸ªç®—æ³•å¼€å§‹å¯è§†åŒ–æ¼”ç¤º
            </div>

            <div class="canvas-container">
                <canvas id="canvas" width="1000" height="400"></canvas>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    <span>æœªå¤„ç†</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12;"></div>
                    <span>æ­£åœ¨æ¯”è¾ƒ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    <span>äº¤æ¢/é€‰ä¸­</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2ecc71;"></div>
                    <span>å·²å®Œæˆ</span>
                </div>
            </div>

            <div class="info-panel">
                <h3 id="algoTitle">ç®—æ³•ä¿¡æ¯</h3>
                <p id="algoInfo">è¯·é€‰æ‹©ä¸€ä¸ªç®—æ³•æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>

                <div class="stats">
                    <div class="stat-card">
                        <div class="label">å½“å‰æ­¥éª¤</div>
                        <div class="value" id="currentStep">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">æ€»æ­¥éª¤</div>
                        <div class="value" id="totalSteps">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">æ¯”è¾ƒæ¬¡æ•°</div>
                        <div class="value" id="comparisons">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">äº¤æ¢æ¬¡æ•°</div>
                        <div class="value" id="swaps">0</div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>ğŸ’» æ•°æ®ç»“æ„å’Œç®—æ³•å¯è§†åŒ–å·¥å…· | è®©å­¦ä¹ ç®—æ³•æ›´ç›´è§‚ã€æ›´æœ‰è¶£</p>
            <p>Made with â¤ï¸ by Claude | 2025</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let currentAlgorithm = null;
        let steps = [];
        let currentStepIndex = 0;
        let isAnimating = false;
        let animationInterval = null;
        let comparisons = 0;
        let swaps = 0;

        // ç®—æ³•æè¿°
        const algorithmDescriptions = {
            bubbleSort: {
                title: 'å†’æ³¡æ’åº (Bubble Sort)',
                description: 'é‡å¤éå†æ•°ç»„,æ¯”è¾ƒç›¸é‚»å…ƒç´ ,å¦‚æœé¡ºåºé”™è¯¯å°±äº¤æ¢å®ƒä»¬,ç›´åˆ°ä¸éœ€è¦å†äº¤æ¢ä¸ºæ­¢ã€‚æ—¶é—´å¤æ‚åº¦: O(nÂ²)',
                info: 'å†’æ³¡æ’åºæ˜¯æœ€ç®€å•çš„æ’åºç®—æ³•ä¹‹ä¸€ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯é‡å¤åœ°éå†è¦æ’åºçš„æ•°åˆ—,ä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ,å¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚'
            },
            insertionSort: {
                title: 'æ’å…¥æ’åº (Insertion Sort)',
                description: 'æ„å»ºæœ‰åºåºåˆ—,å¯¹äºæœªæ’åºæ•°æ®,åœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æ,æ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ—¶é—´å¤æ‚åº¦: O(nÂ²)',
                info: 'æ’å…¥æ’åºçš„å·¥ä½œæ–¹å¼åƒè®¸å¤šäººæ’åºä¸€æ‰‹æ‰‘å…‹ç‰Œã€‚å¼€å§‹æ—¶,æˆ‘ä»¬çš„å·¦æ‰‹ä¸ºç©ºå¹¶ä¸”æ¡Œå­ä¸Šçš„ç‰Œé¢å‘ä¸‹ã€‚ç„¶å,æˆ‘ä»¬æ¯æ¬¡ä»æ¡Œå­ä¸Šæ‹¿èµ°ä¸€å¼ ç‰Œå¹¶å°†å®ƒæ’å…¥å·¦æ‰‹ä¸­æ­£ç¡®çš„ä½ç½®ã€‚'
            },
            selectionSort: {
                title: 'é€‰æ‹©æ’åº (Selection Sort)',
                description: 'æ¯æ¬¡ä»æœªæ’åºéƒ¨åˆ†é€‰æ‹©æœ€å°(å¤§)å…ƒç´ ,æ”¾åˆ°å·²æ’åºéƒ¨åˆ†çš„æœ«å°¾ã€‚æ—¶é—´å¤æ‚åº¦: O(nÂ²)',
                info: 'é€‰æ‹©æ’åºç®—æ³•çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼æ’å…¥æ’åº,ä¹Ÿåˆ†å·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚ä½†æ˜¯é€‰æ‹©æ’åºæ¯æ¬¡ä¼šä»æœªæ’åºåŒºé—´ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ,å°†å…¶æ”¾åˆ°å·²æ’åºåŒºé—´çš„æœ«å°¾ã€‚'
            },
            binarySearch: {
                title: 'äºŒåˆ†æŸ¥æ‰¾ (Binary Search)',
                description: 'åœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ç‰¹å®šå…ƒç´ ,æ¯æ¬¡å°†æœç´¢åŒºé—´ç¼©å°ä¸€åŠã€‚æ—¶é—´å¤æ‚åº¦: O(log n)',
                info: 'äºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„æŸ¥æ‰¾ç®—æ³•ã€‚å‰ææ˜¯æ•°ç»„å¿…é¡»æ˜¯æœ‰åºçš„ã€‚å®ƒçš„æ€æƒ³æ˜¯:æ¯æ¬¡å°†æœç´¢åŒºé—´ç¼©å°ä¸ºä¸€åŠ,ç›´åˆ°æ‰¾åˆ°ç›®æ ‡å…ƒç´ ,æˆ–è€…ç¡®å®šä¸å­˜åœ¨ã€‚'
            },
            findMax: {
                title: 'æŸ¥æ‰¾æœ€å¤§å€¼ (Find Maximum)',
                description: 'éå†æ•°ç»„,è®°å½•å½“å‰æœ€å¤§å€¼,æœ€ç»ˆæ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ ã€‚æ—¶é—´å¤æ‚åº¦: O(n)',
                info: 'æŸ¥æ‰¾æœ€å¤§å€¼æ˜¯ä¸€ä¸ªç®€å•ä½†å®ç”¨çš„ç®—æ³•ã€‚é€šè¿‡ä¸€æ¬¡éå†æ•°ç»„,æ¯”è¾ƒæ¯ä¸ªå…ƒç´ ä¸å½“å‰æœ€å¤§å€¼,æœ€ç»ˆæ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ ã€‚'
            },
            arraySum: {
                title: 'æ•°ç»„æ±‚å’Œ (Array Sum)',
                description: 'éå†æ•°ç»„,ç´¯åŠ æ‰€æœ‰å…ƒç´ ,å¾—åˆ°æ•°ç»„çš„æ€»å’Œã€‚æ—¶é—´å¤æ‚åº¦: O(n)',
                info: 'æ•°ç»„æ±‚å’Œæ˜¯æœ€åŸºç¡€çš„ç®—æ³•ä¹‹ä¸€ã€‚é€šè¿‡éå†æ•°ç»„,å°†æ¯ä¸ªå…ƒç´ ç´¯åŠ åˆ°æ€»å’Œä¸­,æœ€ç»ˆå¾—åˆ°æ‰€æœ‰å…ƒç´ çš„å’Œã€‚'
            }
        };

        // æ›´æ–°é€Ÿåº¦æ˜¾ç¤º
        document.getElementById('speedControl').addEventListener('input', function() {
            document.getElementById('speedValue').textContent = this.value + 'ms';
        });

        // ç”Ÿæˆéšæœºæ•°æ®
        function generateRandomData() {
            const count = 8 + Math.floor(Math.random() * 5); // 8-12ä¸ªæ•°
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(Math.floor(Math.random() * 90) + 10); // 10-99çš„éšæœºæ•°
            }
            document.getElementById('dataInput').value = data.join(', ');
        }

        // è·å–è¾“å…¥æ•°æ®
        function getInputData() {
            const input = document.getElementById('dataInput').value;
            return input.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
        }

        // å¯è§†åŒ–ç®—æ³•
        function visualize(algorithm) {
            currentAlgorithm = algorithm;
            const data = getInputData();

            if (data.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°æ®!');
                return;
            }

            // æ˜¾ç¤º/éšè—ç›®æ ‡å€¼è¾“å…¥æ¡†
            document.getElementById('targetGroup').style.display =
                algorithm === 'binarySearch' ? 'block' : 'none';

            // æ›´æ–°æè¿°
            const desc = algorithmDescriptions[algorithm];
            document.getElementById('algorithmDescription').textContent = desc.description;
            document.getElementById('algoTitle').textContent = desc.title;
            document.getElementById('algoInfo').textContent = desc.info;

            // é‡ç½®ç»Ÿè®¡
            comparisons = 0;
            swaps = 0;
            updateStats();

            // ç”Ÿæˆæ­¥éª¤
            switch (algorithm) {
                case 'bubbleSort':
                    steps = generateBubbleSortSteps(data);
                    break;
                case 'insertionSort':
                    steps = generateInsertionSortSteps(data);
                    break;
                case 'selectionSort':
                    steps = generateSelectionSortSteps(data);
                    break;
                case 'binarySearch':
                    const target = parseInt(document.getElementById('targetInput').value);
                    steps = generateBinarySearchSteps(data.sort((a, b) => a - b), target);
                    break;
                case 'findMax':
                    steps = generateFindMaxSteps(data);
                    break;
                case 'arraySum':
                    steps = generateArraySumSteps(data);
                    break;
            }

            currentStepIndex = 0;
            document.getElementById('totalSteps').textContent = steps.length;
            drawStep(steps[0]);
        }

        // å†’æ³¡æ’åºæ­¥éª¤ç”Ÿæˆ
        function generateBubbleSortSteps(data) {
            const steps = [];
            const arr = [...data];
            const n = arr.length;

            steps.push({
                array: [...arr],
                comparing: [],
                sorted: [],
                description: 'åˆå§‹çŠ¶æ€'
            });

            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n - i - 1; j++) {
                    steps.push({
                        array: [...arr],
                        comparing: [j, j + 1],
                        sorted: Array.from({length: i}, (_, k) => n - 1 - k),
                        description: `æ¯”è¾ƒ ${arr[j]} å’Œ ${arr[j+1]}`
                    });

                    comparisons++;

                    if (arr[j] > arr[j + 1]) {
                        [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                        swaps++;
                        steps.push({
                            array: [...arr],
                            swapped: [j, j + 1],
                            sorted: Array.from({length: i}, (_, k) => n - 1 - k),
                            description: `äº¤æ¢ ${arr[j]} å’Œ ${arr[j+1]}`
                        });
                    }
                }
            }

            steps.push({
                array: [...arr],
                comparing: [],
                sorted: Array.from({length: n}, (_, i) => i),
                description: 'æ’åºå®Œæˆ!'
            });

            return steps;
        }

        // æ’å…¥æ’åºæ­¥éª¤ç”Ÿæˆ
        function generateInsertionSortSteps(data) {
            const steps = [];
            const arr = [...data];
            const n = arr.length;

            steps.push({
                array: [...arr],
                sorted: [0],
                description: 'åˆå§‹çŠ¶æ€'
            });

            for (let i = 1; i < n; i++) {
                const key = arr[i];
                let j = i - 1;

                steps.push({
                    array: [...arr],
                    inserting: i,
                    sorted: Array.from({length: i}, (_, k) => k),
                    description: `é€‰æ‹©å…ƒç´  ${key} å‡†å¤‡æ’å…¥`
                });

                while (j >= 0 && arr[j] > key) {
                    comparisons++;
                    steps.push({
                        array: [...arr],
                        comparing: [j, j + 1],
                        sorted: Array.from({length: i}, (_, k) => k),
                        description: `æ¯”è¾ƒ ${arr[j]} > ${key}, å‘å³ç§»åŠ¨`
                    });

                    arr[j + 1] = arr[j];
                    j--;
                }

                arr[j + 1] = key;
                swaps++;

                steps.push({
                    array: [...arr],
                    sorted: Array.from({length: i + 1}, (_, k) => k),
                    description: `å°† ${key} æ’å…¥åˆ°ä½ç½® ${j + 1}`
                });
            }

            steps.push({
                array: [...arr],
                sorted: Array.from({length: n}, (_, i) => i),
                description: 'æ’åºå®Œæˆ!'
            });

            return steps;
        }

        // é€‰æ‹©æ’åºæ­¥éª¤ç”Ÿæˆ
        function generateSelectionSortSteps(data) {
            const steps = [];
            const arr = [...data];
            const n = arr.length;

            steps.push({
                array: [...arr],
                sorted: [],
                description: 'åˆå§‹çŠ¶æ€'
            });

            for (let i = 0; i < n; i++) {
                let minIdx = i;

                steps.push({
                    array: [...arr],
                    minIndex: minIdx,
                    sorted: Array.from({length: i}, (_, k) => k),
                    description: `åœ¨ä½ç½® ${i} åˆ° ${n-1} ä¸­å¯»æ‰¾æœ€å°å€¼`
                });

                for (let j = i + 1; j < n; j++) {
                    comparisons++;
                    steps.push({
                        array: [...arr],
                        comparing: [j, minIdx],
                        minIndex: minIdx,
                        sorted: Array.from({length: i}, (_, k) => k),
                        description: `æ¯”è¾ƒ ${arr[j]} å’Œå½“å‰æœ€å°å€¼ ${arr[minIdx]}`
                    });

                    if (arr[j] < arr[minIdx]) {
                        minIdx = j;
                    }
                }

                if (minIdx !== i) {
                    [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
                    swaps++;
                    steps.push({
                        array: [...arr],
                        swapped: [i, minIdx],
                        sorted: Array.from({length: i}, (_, k) => k),
                        description: `äº¤æ¢ ${arr[minIdx]} å’Œ ${arr[i]}`
                    });
                }

                steps.push({
                    array: [...arr],
                    sorted: Array.from({length: i + 1}, (_, k) => k),
                    description: `ä½ç½® ${i} å·²æ’åº`
                });
            }

            steps.push({
                array: [...arr],
                sorted: Array.from({length: n}, (_, i) => i),
                description: 'æ’åºå®Œæˆ!'
            });

            return steps;
        }

        // äºŒåˆ†æŸ¥æ‰¾æ­¥éª¤ç”Ÿæˆ
        function generateBinarySearchSteps(data, target) {
            const steps = [];
            const arr = [...data];
            let low = 0, high = arr.length - 1;

            steps.push({
                array: arr,
                low: low,
                high: high,
                target: target,
                description: `åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾ ${target}`
            });

            while (low <= high) {
                const mid = Math.floor(low + (high - low) / 2);
                comparisons++;

                steps.push({
                    array: arr,
                    low: low,
                    high: high,
                    mid: mid,
                    target: target,
                    description: `æ£€æŸ¥ä¸­é—´ä½ç½® ${mid}, å€¼ä¸º ${arr[mid]}`
                });

                if (arr[mid] === target) {
                    steps.push({
                        array: arr,
                        low: low,
                        high: high,
                        mid: mid,
                        found: true,
                        target: target,
                        description: `æ‰¾åˆ°ç›®æ ‡å€¼ ${target} åœ¨ä½ç½® ${mid}!`
                    });
                    break;
                } else if (arr[mid] < target) {
                    steps.push({
                        array: arr,
                        low: low,
                        high: high,
                        mid: mid,
                        target: target,
                        description: `${arr[mid]} < ${target}, åœ¨å³åŠéƒ¨åˆ†æŸ¥æ‰¾`
                    });
                    low = mid + 1;
                } else {
                    steps.push({
                        array: arr,
                        low: low,
                        high: high,
                        mid: mid,
                        target: target,
                        description: `${arr[mid]} > ${target}, åœ¨å·¦åŠéƒ¨åˆ†æŸ¥æ‰¾`
                    });
                    high = mid - 1;
                }
            }

            if (low > high) {
                steps.push({
                    array: arr,
                    target: target,
                    description: `æœªæ‰¾åˆ°ç›®æ ‡å€¼ ${target}`
                });
            }

            return steps;
        }

        // æŸ¥æ‰¾æœ€å¤§å€¼æ­¥éª¤ç”Ÿæˆ
        function generateFindMaxSteps(data) {
            const steps = [];
            const arr = [...data];
            let maxIdx = 0;

            steps.push({
                array: arr,
                current: 0,
                maxIndex: 0,
                description: `åˆå§‹æœ€å¤§å€¼: ${arr[0]} (ä½ç½® 0)`
            });

            for (let i = 1; i < arr.length; i++) {
                comparisons++;
                steps.push({
                    array: arr,
                    current: i,
                    maxIndex: maxIdx,
                    description: `æ¯”è¾ƒ ${arr[i]} å’Œå½“å‰æœ€å¤§å€¼ ${arr[maxIdx]}`
                });

                if (arr[i] > arr[maxIdx]) {
                    maxIdx = i;
                    steps.push({
                        array: arr,
                        current: i,
                        maxIndex: maxIdx,
                        description: `æ›´æ–°æœ€å¤§å€¼: ${arr[i]} (ä½ç½® ${i})`
                    });
                }
            }

            steps.push({
                array: arr,
                current: arr.length - 1,
                maxIndex: maxIdx,
                description: `æ‰¾åˆ°æœ€å¤§å€¼: ${arr[maxIdx]} (ä½ç½® ${maxIdx})`
            });

            return steps;
        }

        // æ•°ç»„æ±‚å’Œæ­¥éª¤ç”Ÿæˆ
        function generateArraySumSteps(data) {
            const steps = [];
            const arr = [...data];
            let sum = 0;

            steps.push({
                array: arr,
                current: -1,
                sum: 0,
                description: 'å¼€å§‹æ±‚å’Œ, åˆå§‹å’Œä¸º 0'
            });

            for (let i = 0; i < arr.length; i++) {
                steps.push({
                    array: arr,
                    current: i,
                    sum: sum,
                    description: `å½“å‰å’Œ: ${sum}, åŠ ä¸Š ${arr[i]}`
                });

                sum += arr[i];

                steps.push({
                    array: arr,
                    current: i,
                    sum: sum,
                    description: `ç´¯åŠ åçš„å’Œ: ${sum}`
                });
            }

            steps.push({
                array: arr,
                current: arr.length - 1,
                sum: sum,
                description: `æœ€ç»ˆå’Œ: ${sum}`
            });

            return steps;
        }

        // ç»˜åˆ¶æ­¥éª¤
        function drawStep(step) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const arr = step.array;
            const n = arr.length;
            const maxVal = Math.max(...arr);
            const barWidth = Math.min(80, (canvas.width - 100) / n);
            const maxHeight = canvas.height - 100;

            // ç»˜åˆ¶æ¯ä¸ªå…ƒç´ 
            for (let i = 0; i < n; i++) {
                const height = (arr[i] / maxVal) * maxHeight;
                const x = 50 + i * barWidth;
                const y = canvas.height - 50 - height;

                // ç¡®å®šé¢œè‰²
                let color = '#3498db'; // é»˜è®¤è“è‰²

                if (step.sorted && step.sorted.includes(i)) {
                    color = '#2ecc71'; // ç»¿è‰² - å·²æ’åº
                } else if (step.comparing && step.comparing.includes(i)) {
                    color = '#f39c12'; // æ©™è‰² - æ­£åœ¨æ¯”è¾ƒ
                } else if (step.swapped && step.swapped.includes(i)) {
                    color = '#e74c3c'; // çº¢è‰² - äº¤æ¢
                } else if (step.inserting === i) {
                    color = '#9b59b6'; // ç´«è‰² - æ’å…¥
                } else if (step.minIndex === i) {
                    color = '#f1c40f'; // é»„è‰² - æœ€å°å€¼
                } else if (step.maxIndex === i) {
                    color = '#2ecc71'; // ç»¿è‰² - æœ€å¤§å€¼
                } else if (step.current === i) {
                    color = '#f39c12'; // æ©™è‰² - å½“å‰å…ƒç´ 
                } else if (step.mid === i) {
                    if (step.found) {
                        color = '#2ecc71'; // ç»¿è‰² - æ‰¾åˆ°
                    } else {
                        color = '#f39c12'; // æ©™è‰² - ä¸­é—´
                    }
                } else if (step.low !== undefined && step.high !== undefined) {
                    if (i >= step.low && i <= step.high) {
                        color = '#3498db'; // è“è‰² - æœç´¢èŒƒå›´
                    } else {
                        color = '#bdc3c7'; // ç°è‰² - è¶…å‡ºèŒƒå›´
                    }
                }

                // ç»˜åˆ¶æŸ±å­
                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth - 10, height);
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, barWidth - 10, height);

                // ç»˜åˆ¶æ•°å€¼
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(arr[i], x + (barWidth - 10) / 2, y - 5);

                // ç»˜åˆ¶ç´¢å¼•
                ctx.fillStyle = '#7f8c8d';
                ctx.font = '12px Arial';
                ctx.fillText(i, x + (barWidth - 10) / 2, canvas.height - 30);
            }

            // ç»˜åˆ¶ç›®æ ‡çº¿ï¼ˆäºŒåˆ†æŸ¥æ‰¾ï¼‰
            if (step.target !== undefined) {
                const targetY = canvas.height - 50 - (step.target / maxVal) * maxHeight;
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(30, targetY);
                ctx.lineTo(canvas.width - 30, targetY);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`ç›®æ ‡: ${step.target}`, canvas.width - 100, targetY - 5);
            }

            // ç»˜åˆ¶æè¿°
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(step.description, canvas.width / 2, 30);

            // å¦‚æœæ˜¯æ±‚å’Œ,æ˜¾ç¤ºå½“å‰å’Œ
            if (step.sum !== undefined) {
                ctx.fillStyle = '#667eea';
                ctx.font = 'bold 20px Arial';
                ctx.fillText(`å½“å‰å’Œ: ${step.sum}`, canvas.width / 2, 60);
            }

            // æ›´æ–°æ­¥éª¤æ˜¾ç¤º
            document.getElementById('currentStep').textContent = currentStepIndex + 1;
            updateStats();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('comparisons').textContent = comparisons;
            document.getElementById('swaps').textContent = swaps;
        }

        // åŠ¨ç”»æ§åˆ¶
        function startAnimation() {
            if (steps.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç®—æ³•!');
                return;
            }

            if (isAnimating) return;

            isAnimating = true;
            const speed = parseInt(document.getElementById('speedControl').value);

            animationInterval = setInterval(() => {
                if (currentStepIndex < steps.length - 1) {
                    currentStepIndex++;
                    drawStep(steps[currentStepIndex]);
                } else {
                    pauseAnimation();
                }
            }, speed);
        }

        function pauseAnimation() {
            isAnimating = false;
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
        }

        function stepForward() {
            if (steps.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç®—æ³•!');
                return;
            }

            if (currentStepIndex < steps.length - 1) {
                currentStepIndex++;
                drawStep(steps[currentStepIndex]);
            }
        }

        function resetAnimation() {
            pauseAnimation();
            currentStepIndex = 0;
            if (steps.length > 0) {
                drawStep(steps[0]);
            }
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            ctx.fillStyle = '#ecf0f1';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#7f8c8d';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('é€‰æ‹©ä¸€ä¸ªç®—æ³•å¼€å§‹å¯è§†åŒ–æ¼”ç¤º', canvas.width / 2, canvas.height / 2);
        };
    </script>
</body>
</html>
